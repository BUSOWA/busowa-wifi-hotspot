"use strict";(()=>{var e={};e.id=596,e.ids=[596],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},4821:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>U,patchFetch:()=>v,requestAsyncStorage:()=>I,routeModule:()=>g,serverHooks:()=>T,staticGenerationAsyncStorage:()=>S});var n={};r.r(n),r.d(n,{POST:()=>y});var o=r(9303),s=r(8716),a=r(670),i=r(6113),p=r.n(i);let u={randomUUID:p().randomUUID},c=new Uint8Array(256),m=c.length,l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));let d=function(e,t,r){if(u.randomUUID&&!t&&!e)return u.randomUUID();let n=(e=e||{}).random||(e.rng||function(){return m>c.length-16&&(p().randomFillSync(c),m=0),c.slice(m,m+=16)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]}(n)},h=process.env.MTN_SUBSCRIPTION_KEY;async function y(e){let{phone:t,amount:r,packageId:n}=await e.json();if(!/^256(77|78)\d{7}$/.test(t))return Response.json({success:!1,error:"Invalid MTN number"},{status:400});let o=d(),s={amount:r.toString(),currency:"UGX",externalId:o,payer:{partyIdType:"MSISDN",partyId:t},payerMessage:`BUSOWA WIFI: ${1===n?"8hrs":2===n?"24hrs":"2 Days"} - UGX ${r}`,payeeNote:"WiFi Hotspot Voucher"};try{if(!(await fetch("https://proxy.momoapi.mtn.com/collection/v1_0/requesttopay",{method:"POST",headers:{Authorization:`Bearer ${await f()}`,"X-Reference-Id":o,"X-Target-Environment":"sandbox","Content-Type":"application/json","Ocp-Apim-Subscription-Key":h},body:JSON.stringify(s)})).ok)throw Error("MTN API error");return global.mtnTransactions=global.mtnTransactions||{},global.mtnTransactions[o]={phone:t,amount:r,packageId:n,status:"PENDING"},Response.json({success:!0,message:"Check your phone for MTN MoMo prompt!",transactionId:o})}catch(e){return Response.json({success:!1,error:e.message},{status:500})}}async function f(){let e=process.env.MTN_API_KEY,t=Buffer.from(`:${e}`).toString("base64"),r=await fetch("https://proxy.momoapi.mtn.com/collection/token/",{method:"POST",headers:{Authorization:`Basic ${t}`,"Ocp-Apim-Subscription-Key":h}});return(await r.json()).access_token}process.env.VERCEL_URL;let g=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/mtn/initiate/route",pathname:"/api/mtn/initiate",filename:"route",bundlePath:"app/api/mtn/initiate/route"},resolvedPagePath:"C:\\Users\\DJ PROPERTY\\Desktop\\busowa-wifi-hotspot\\app\\api\\mtn\\initiate\\route.js",nextConfigOutput:"",userland:n}),{requestAsyncStorage:I,staticGenerationAsyncStorage:S,serverHooks:T}=g,U="/api/mtn/initiate/route";function v(){return(0,a.patchFetch)({serverHooks:T,staticGenerationAsyncStorage:S})}},9303:(e,t,r)=>{e.exports=r(517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948],()=>r(4821));module.exports=n})();